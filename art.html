<!DOCTYPE html>
<html>
<head>
  <title>Image Gallery with Fireflies</title>
  <style>
    .gallery {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
    }

    .gallery img {
      width: 200px;
      height: 200px;
      margin: 10px;
    }
  </style>
</head>
<body>
  <div class="gallery"></div>
  <canvas id="canvas"></canvas>

  <script>
    // Image gallery
    function loadImages() {
      var gallery = document.querySelector('.gallery');

      // Fetch the images from the "./art" folder
      fetch('./art')
        .then(response => response.text())
        .then(data => {
          var parser = new DOMParser();
          var html = parser.parseFromString(data, 'text/html');
          var links = html.querySelectorAll('a');

          // Filter image files
          var imageFiles = Array.from(links)
            .filter(link => link.href.toLowerCase().match(/\.(jpg|jpeg|png|gif)$/));

          // Create <img> elements for each image file
          imageFiles.forEach(file => {
            var img = document.createElement('img');
            img.src = './art/' + file.href;
            gallery.appendChild(img);
          });
        })
        .catch(error => console.error(error));
    }

    // Call the loadImages function when the page finishes loading
    window.addEventListener('load', loadImages);

    // Firefly animation
    let canvas = document.getElementById("canvas"),
      c = init("canvas"),
      w = (canvas.width = window.innerWidth),
      h = (canvas.height = window.innerHeight);
      
    class Firefly {
      constructor() {
        this.x = Math.random() * w;
        this.y = Math.random() * h;
        this.s = Math.random() * 2;
        this.ang = Math.random() * 2 * Math.PI;
        this.v = this.s * this.s / 4;
      }
      move() {
        this.x += this.v * Math.cos(this.ang);
        this.y += this.v * Math.sin(this.ang);
        this.ang += Math.random() * 20 * Math.PI / 180 - 10 * Math.PI / 180;
      }
      show() {
        c.beginPath();
        c.arc(this.x, this.y, this.s, 0, 2 * Math.PI);
        c.fillStyle = "#fddba3";
        c.fill();
      }
    }

    let f = [];

    function draw() {
      if (f.length < 100) {
        for (let j = 0; j < 10; j++) {
          f.push(new Firefly());
        }
      }
      // Animation
      for (let i = 0; i < f.length; i++) {
        f[i].move();
        f[i].show();
        if (f[i].x < 0 || f[i].x > w || f[i].y < 0 || f[i].y > h) {
          f.splice(i, 1);
        }
      }
    }

    let mouse = {};
    let last_mouse = {};

    canvas.addEventListener(
      "mousemove",
      function(e) {
        last_mouse.x = mouse.x;
        last_mouse.y = mouse.y;

        mouse.x = e.pageX - this.offsetLeft;
        mouse.y = e.pageY - this.offsetTop;
      },
      false
    );

    function init(elemid) {
      let canvas = document.getElementById(elemid),
        c = canvas.getContext("2d"),
        w = (canvas.width = window.innerWidth),
        h = (canvas.height = window.innerHeight);
      c.fillStyle = "rgba(30,30,30,1)";
      c.fillRect(0, 0, w, h);
      return c;
    }

    window.requestAnimFrame = (function() {
      return (
        window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.oRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        function(callback) {
          window.setTimeout(callback);
        }
      );
    });

    function loop() {
      window.requestAnimFrame(loop);
      c.clearRect(0, 0, w, h);
      draw();
    }

    window.addEventListener("resize", function() {
      (w = canvas.width = window.innerWidth), (h = canvas.height = window.innerHeight);
      loop();
    });

    loop();
    setInterval(loop, 1000 / 60);
  </script>
</body>
</html>
